# 系统设计文档

## 新增调试功能实现 (2024-06-20)

### 调试入口实现
1. **remote_trace() 方法**
   - 模仿pdb.set_trace()的工作方式
   - 启动调试服务器并阻塞主线程
   - 自动分配端口并打印访问地址
   - 支持键盘中断关闭服务

2. 双重输出系统
   - **执行结果输出**：保持原有JSON结构
   - **终端模拟输出**：
     - 捕获stdout/stderr
     - 添加时间戳前缀
     - 保留最近100条日志
     - 实时输出到真实终端

3. 服务增强
   - 添加/console端点获取最近日志
   - 执行历史记录服务运行时间
   - 错误日志分级记录

### 前端显示增强
1. 双选项卡面板设计
   - 执行结果保持原有样式
   - 终端输出面板特性：
     - 等宽字体显示
     - 自动滚动到底部
     - 深色背景高对比度
     - 显示原始服务端日志

2. 实时性保证
   - 每次执行后获取最新日志
   - 保留最近20条终端记录
   - 错误信息同时显示在两个面板

## 原有功能调整
1. 执行结果数据结构变更
```json
{
  "status": "success",
  "output": "常规输出",
  "error": "",
  "console": "完整终端日志" 
}
```

2. 历史记录存储增强
```javascript
{
  code: "print('hello')",
  output: "hello",
  console: "[2024-06-20 10:00:00] STDOUT: hello", 
  timestamp: 1718856000
}
```

3. 安全增强
- 限制console端点返回最近20条
- 执行上下文隔离保持原有机制
- 终端日志不存储敏感信息